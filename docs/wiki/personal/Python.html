


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="/wiki.css">

<title>Python</title>

</head>

<div class="site-title"><a href="/wiki/">Wiki</a> by <a href="https://philipkd.com/">Philip Dhingra</a></div>

<div class="entry">

<div class="page-title">Python</div>

<h1>argparse</h1>

<p><code>args = parse_arguments(['--flag','1'])</code></p>

<p><code>parse_arguments()</code> pulls from sys.argv</p>

<p><code>parse_arguments(['--flag','1'])</code> pulls from just the array and is equivalent to <code>python filename.py --flag 1</code></p>

<p>But both combine with the preset arguments.</p>

<h1>arrays</h1>

<p><code>a[start:stop]</code>  # items start through stop-1<br />
<code>a[start:]</code>      # items start through the rest of the array<br />
<code>a[:stop]</code>       # items from the beginning through stop-1<br />
<code>a[:]</code>           # a copy of the whole array  </p>

<p><code>a[-1]</code>    # last item in the array<br />
<code>a[-2:]</code>   # last two items in the array<br />
<code>a[:-2]</code>   # everything except the last two items  </p>

<h1>environment variables</h1>

<p><code>os.environ["CLOUDSDK_CONFIG"] = 'xyz'</code></p>

<h1>memory issues</h1>

<h2><a href="https://stackoverflow.com/a/23883524/210173">mem_top</a></h2>

<p>Reveals top classes with high reference counts</p>

<h2>Object Graphs</h2>

<p>Show growth in object types on the heap:</p>

<p><code>objgraph.show_growth()</code><br />
<code>do_something()</code><br />
<code>objgraph.show_growth()</code>  </p>

<h2>GPU Stats</h2>

<p>Snippet that has comparable GPU stats to Kaggle:</p>

<p><code>import subprocess as sp</code>
<code>_output_to_list = lambda x: x.decode('ascii').split('\n')[:-1]</code><br />
<code>ACCEPTABLE_AVAILABLE_MEMORY = 1024</code><br />
<code>COMMAND = "nvidia-smi --query-gpu=memory.used --format=csv"</code><br />
<code>memory_used_info = _output_to_list(sp.check_output(COMMAND.split()))[1:]</code><br />
<code>memory_used_values = [int(x.split()[0]) for i, x in enumerate(memory_used_info)]</code><br />
<code>print("GPU MEM: %0.1f / 15.9 GB" % (memory_used_values[0] / 1000))</code>  </p>

<p><a href="https://stackoverflow.com/questions/59567226/how-to-programmatically-determine-available-gpu-memory-with-tensorflow">source (tweaked)</a></p>

<h2>LD_PRELOAD jemalloc</h2>

<p>Setting jemalloc as the default allocator is <a href="https://github.com/pandas-dev/pandas/issues/2659#issuecomment-457193523">a popular solution</a></p>

<h2>LRU&#95;CACHE_CAPACITY=1</h2>

<p>Setting LRU&#95;CACHE_CAPACITY=1 is a magical solution for memory leaks when "<a href="https://github.com/pytorch/pytorch/issues/29893">evaluating model on CPU with dynamic size tensor input.</a>"</p>

<h2>malloc_trim</h2>

<p><a href="https://github.com/pandas-dev/pandas/issues/2659#issuecomment-415177442">Solution for cyclic GC issues</a></p>

<h2>multiprocessing pool</h2>

<p><a href="https://stackoverflow.com/a/39101287/210173">Spawning a separate process</a> will sandbox the memory</p>

<br/>
<a href="https://licensebuttons.net/l/by/4.0/"><img src="https://licensebuttons.net/l/by/4.0/80x15.png"></a>